<div class="theme-toggle">
    <button
        id="theme-toggle-btn"
        class="flex items-center gap-3 px-4 py-2 rounded-lg border border-themed transition-colors font-sans text-sm"
        style="--hover-bg: color-mix(in srgb, var(--color-nyt-accent) 10%, transparent);"
        onmouseover="this.style.backgroundColor='var(--hover-bg)'"
        onmouseout="this.style.backgroundColor='transparent'"
        aria-label="Toggle theme"
    >
        <span id="theme-icon">‚òÄÔ∏è</span>
        <span id="theme-label" class="uppercase tracking-wide">Light</span>
    </button>
</div>

<script>
    const THEMES = ["light", "sepia", "dark"] as const;
    const THEME_LABELS: Record<string, { label: string; icon: string }> = {
        light: { label: "Light", icon: "‚òÄÔ∏è" },
        sepia: { label: "Sepia", icon: "üìú" },
        dark: { label: "Dark", icon: "üåô" },
    };

    const getTheme = () => {
        return localStorage.getItem("theme") || "light";
    };

    const setTheme = (theme: string) => {
        document.documentElement.setAttribute("data-theme", theme);
        localStorage.setItem("theme", theme);
        updateThemeButton(theme);
    };

    const updateThemeButton = (theme: string) => {
        const label = document.getElementById("theme-label");
        const icon = document.getElementById("theme-icon");
        if (label && icon) {
            label.textContent = THEME_LABELS[theme].label;
            icon.textContent = THEME_LABELS[theme].icon;
        }
    };

    const cycleTheme = () => {
        const currentTheme = getTheme();
        const currentIndex = THEMES.indexOf(
            currentTheme as (typeof THEMES)[number],
        );
        const nextIndex = (currentIndex + 1) % THEMES.length;
        setTheme(THEMES[nextIndex]);
    };

    // Initialize on load
    document.addEventListener("DOMContentLoaded", () => {
        const currentTheme = getTheme();
        updateThemeButton(currentTheme);

        const button = document.getElementById("theme-toggle-btn");
        button?.addEventListener("click", cycleTheme);
    });

    // Handle view transitions
    document.addEventListener("astro:after-swap", () => {
        const currentTheme = getTheme();
        setTheme(currentTheme);
    });
</script>
